
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// User model improvements

model User {
  id                  String              @id @default(uuid())
  username            String              @unique
  email               String              @unique
  password            String
  leetcodeUsername    String?             // Made optional since user might only have CodeForces
  codeforcesUsername  String?             // Made optional since user might only have LeetCode
  section            String
  enrollmentNum      String              @unique
  profileUrl         String?
  groupId            String?
  group              Group?              @relation(fields: [groupId], references: [id])
  submissions        Submission[]
  individualPoints   Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  coordinatedGroup   Group?              @relation("GroupCoordinator") 
  
  @@index([groupId]) 
}


model Group {
  id                String              @id @default(uuid())
  name              String              @unique
  coordinator       User                @relation("GroupCoordinator", fields: [coordinatorId], references: [id])
  coordinatorId     String              @unique
  members           User[]
  contestsAttempted GroupOnContest[]
  groupPoints       Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([coordinatorId])
}

// Rest of the models remain the same
model Contest {
  id                Int                 @id @default(autoincrement())
  startTime         DateTime            // Added start time
  endTime           DateTime            // Added end time
  status            ContestStatus       @default(UPCOMING) // Added status enum
  questions         QuestionOnContest[]
  submissions       Submission[]
  attemptedGroups   GroupOnContest[]
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status, startTime]) // Index for filtering active contests
}

enum ContestStatus {
  UPCOMING
  ACTIVE
  COMPLETED
}

model GroupOnContest {
  id                String              @id @default(uuid())
  groupId           String
  contestId         Int
  contest           Contest             @relation(fields: [contestId], references: [id])
  group             Group               @relation(fields: [groupId], references: [id])
  score             Int                 @default(0)
  rank              Int?                // Added rank field
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@unique([groupId, contestId])
  @@index([contestId, score]) // Index for leaderboard queries
}

model Question {
  id                String              @id @default(uuid())
  leetcodeUrl       String?             // Made optional
  codeforcesUrl     String?             // Made optional
  difficulty        Difficulty          // Changed to enum
  points            Int
  questionTags      QuestionTag[]       // Changed from string[] to relation
  slug              String              @unique
  contests          QuestionOnContest[]
  submissions       Submission[]        // Added direct relation to submissions
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

}

model QuestionTag {
  id          String    @id @default(uuid())
  name        String    @unique
  questions   Question[]
  createdAt   DateTime  @default(now())
}

enum QuestionPlatform {
  LEETCODE
  CODEFORCES
}

enum Difficulty {
  BEGINNER
  EASY
  MEDIUM
  HARD
  VERYHARD
}

model QuestionOnContest {
  id                String              @id @default(uuid())
  contestId         Int
  questionId        String
  contest           Contest             @relation(fields: [contestId], references: [id])
  question          Question            @relation(fields: [questionId], references: [id])
  createdAt         DateTime            @default(now())

  @@unique([contestId, questionId])
}

model Submission {
  id                String              @id @default(uuid())
  userId            String
  questionId        String              // Added direct relation to question
  contestId         Int
  score             Int                 @default(0)
  status            SubmissionStatus    // Added submission status
  user              User                @relation(fields: [userId], references: [id])
  question          Question            @relation(fields: [questionId], references: [id])
  contest           Contest             @relation(fields: [contestId], references: [id])
  createdAt         DateTime            @default(now())

  @@index([userId, contestId]) // Index for user's contest submissions
  @@index([contestId, score]) // Index for contest leaderboard
}

enum SubmissionStatus {
  PENDING
  ACCEPTED
  WRONG_ANSWER
  TIME_LIMIT_EXCEEDED
  MEMORY_LIMIT_EXCEEDED
  RUNTIME_ERROR
  COMPILATION_ERROR
}